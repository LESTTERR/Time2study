<html lang="en">
<head>
  <link rel="manifest" href="manifest.json">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Study Planner â€“ Profile</title>
  <link rel="stylesheet" href="gome.css">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <style>
    body {
      
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }

    .profile-card {
      background: transparent;
      padding: 0;
      border-radius: 0;
      box-shadow: none;
      max-width: none;
      margin: 0;
    }

    .profile-header {
      text-align: center;
      margin: 1rem 0;
    }

    .profile-pic .material-icons {
      font-size: 80px;
      color: #1E3C72;
    }

    .profile-info {
      padding: 0 1rem;
    }

    .info-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }

    .info-row input {
      flex: 1;
      padding: 0.4rem 0.6rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      background: white;
      color: #333;
    }

    .profile-buttons {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
      padding: 0 1rem;
    }

    button {
      padding: 0.5rem 1.2rem;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
    }

    .edit-btn { background: #1E3C72; color: white; }
    .save-btn { background: #2ecc71; color: white; }
    .logout-btn { background: #e74c3c; color: white; }


@media (max-width: 600px) {
  df-messenger {
    --df-messenger-min-width: 100vw;
    --df-messenger-min-height: 40vh;
    --df-messenger-chat-background-color: #fff;
  }

  df-messenger::part(chat) {
    max-height: 60vh;
    bottom: 60px !important;
  }
}


    
  </style>
</head>

<body>
  <div class="app-container">
    <div class="content-section active" id="profileSection">
      <div class="profile-card">
        <div class="profile-header">
          <div class="profile-pic">
            <span class="material-icons">account_circle</span>
          </div>
          <h2 id="userName">Loading...</h2>
        </div>

        <div class="profile-info">
          <div class="info-row">
            <span class="material-icons">email</span>
            <input type="email" id="userEmail" disabled>
          </div>
          <div class="info-row">
            <span class="material-icons">school</span>
            <input type="text" id="userSchool" disabled>
          </div>
          <div class="info-row">
            <span class="material-icons">person</span>
            <input type="text" id="userAge" disabled>
          </div>
        </div>

        <div class="profile-buttons">
          <button class="edit-btn" id="editBtn">Edit</button>
          <button class="save-btn" id="saveBtn" style="display: none;">Save</button>
          <button class="logout-btn" id="logoutBtn">Log Out</button>
        </div>
      </div>
    </div>

   <nav class="tab-bar">
  <a href="home.html" class="tab-item">
    <span class="material-icons">calendar_today</span>
    <span class="tab-label">Home</span>
  </a>
  <a href="tasks.html" class="tab-item">
    <span class="material-icons">assignment</span>
    <span class="tab-label">Tasks</span>
  </a>
  <a href="classes.html" class="tab-item">
    <span class="material-icons">class</span>
    <span class="tab-label">Classes</span>
  </a>
  <a href="profile.html" class="tab-item active">
    <span class="material-icons">person</span>
    <span class="tab-label">Profile</span>
  </a>
</nav>
  </div>
 
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDBZ7tcCJJdGCo7C8FXRiUPQ8OfOzexllc",
    authDomain: "time2study-4f2f3.firebaseapp.com",
    projectId: "time2study-4f2f3",
    storageBucket: "time2study-4f2f3.appspot.com",
    messagingSenderId: "856561565211",
    appId: "1:856561565211:web:e59307f6c4dcb7a52582be",
    measurementId: "G-9S9C5D6TXF"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const userName = document.getElementById('userName');
  const userEmail = document.getElementById('userEmail');
  const userSchool = document.getElementById('userSchool');
  const userAge = document.getElementById('userAge');
  const editBtn = document.getElementById('editBtn');
  const saveBtn = document.getElementById('saveBtn');
  const inputs = document.querySelectorAll('#profileSection input');

  const setLoadingState = () => {
    userName.textContent = "Loading...";
    userEmail.value = "";
    userSchool.value = "";
    userAge.value = "";
  };

  const loadProfile = async (uid) => {
    setLoadingState();
    try {
      const userDoc = await getDoc(doc(db, "users", uid));
      if (userDoc.exists()) {
        const data = userDoc.data();
        userName.textContent = data.fullName || 'Not set';
        userEmail.value = data.email || 'Not set';
        userSchool.value = data.school || 'Not set';
        userAge.value = data.age || 'Not set';
      } else {
        userName.textContent = "User not found";
      }
    } catch (error) {
      userName.textContent = "Error loading profile";
      alert(`Error loading profile: ${error.message}`);
    }
  };

  onAuthStateChanged(auth, (user) => {
    if (user) {
      loadProfile(user.uid);
    } else {
      window.location.href = 'login.html';
    }
  });

  editBtn.addEventListener('click', () => {
    inputs.forEach(input => input.disabled = false);
    editBtn.style.display = 'none';
    saveBtn.style.display = 'inline-block';
  });

  saveBtn.addEventListener('click', async () => {
    try {
      const user = auth.currentUser;
      if (!user) return;
      await updateDoc(doc(db, "users", user.uid), {
        fullName: userName.textContent,
        school: userSchool.value,
        age: Number(userAge.value)
      });
      inputs.forEach(input => input.disabled = true);
      saveBtn.style.display = 'none';
      editBtn.style.display = 'inline-block';
      alert('Profile updated successfully!');
    } catch (error) {
      alert(`Error saving profile: ${error.message}`);
    }
  });

  function logout() {
  sessionStorage.clear(); // or sessionStorage.removeItem('loggedIn');
  window.location.href = 'login.html';
}


  document.getElementById('logoutBtn').addEventListener('click', async () => {
    try {
      await signOut(auth);
      window.location.href = 'login.html';
    } catch (error) {
      alert(`Logout failed: ${error.message}`);
    }
  });
</script>
<script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
  <script>
  window.addEventListener('dfMessengerLoaded', function () {
    const dfMessenger = document.querySelector('df-messenger');
    const shadowRoot = dfMessenger.shadowRoot;

    if (shadowRoot) {
      const style = document.createElement('style');
      style.textContent = `
        df-messenger-chat {
          bottom: 100px !important; /* pushes chat above tab bar */
          max-height: 60vh !important;
        }

        df-messenger-icon {
          bottom: 100px !important; /* moves icon too */
        }
      `;
      shadowRoot.appendChild(style);
    }
  });
</script>

<df-messenger
  intent="WELCOME"
  chat-title="T2SBOT"
  agent-id="4558beea-12ba-46e0-9f37-0a0c394f92ec"
  language-code="en"
></df-messenger>


</body>
</html>
