<html lang="en">
<head>
  <link rel="manifest" href="manifest.json">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Study Planner â€“ Profile</title>
  <link rel="stylesheet" href="gome.css">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="profile.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">


</head>

<body>
  <div class="app-container">
    <div class="content-section active" id="profileSection">
      <div class="profile-card">
        <div class="profile-header">
          <div class="profile-pic">
            <span class="material-icons">account_circle</span>
          </div>
          <h2 id="userName">Loading...</h2>
        </div>

        <div class="profile-info">
          <div class="info-row">
            <span class="material-icons">email</span>
            <input type="email" id="userEmail" disabled>
          </div>
          <div class="info-row">
            <span class="material-icons">school</span>
            <input type="text" id="userSchool" disabled>
          </div>
          <div class="info-row">
            <span class="material-icons">person</span>
            <input type="number" id="userAge" disabled>
          </div>
        </div>

        <div class="profile-buttons">
          <button class="edit-btn" id="editBtn">Edit</button>
          <button class="save-btn" id="saveBtn" style="display: none;">Save</button>
          <button class="logout-btn" id="logoutBtn">Log Out</button>
        </div>
      </div>
    </div></div>


   <nav class="tab-bar">
  <a href="home.html" class="tab-item">
    <span class="material-icons">calendar_today</span>
    <span class="tab-label">Home</span>
  </a>
  <a href="tasks.html" class="tab-item">
    <span class="material-icons">assignment</span>
    <span class="tab-label">Tasks</span>
  </a>
  <a href="classes.html" class="tab-item">
    <span class="material-icons">class</span>
    <span class="tab-label">Classes</span>
  </a>
  <a href="profile.html" class="tab-item active">
    <span class="material-icons">person</span>
    <span class="tab-label">Profile</span>
  </a>
</nav>

 
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDBZ7tcCJJdGCo7C8FXRiUPQ8OfOzexllc",
    authDomain: "time2study-4f2f3.firebaseapp.com",
    projectId: "time2study-4f2f3",
    storageBucket: "time2study-4f2f3.appspot.com",
    messagingSenderId: "856561565211",
    appId: "1:856561565211:web:e59307f6c4dcb7a52582be",
    measurementId: "G-9S9C5D6TXF"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const userName = document.getElementById('userName');
  const userEmail = document.getElementById('userEmail');
  const userSchool = document.getElementById('userSchool');
  const userAge = document.getElementById('userAge');
  const editBtn = document.getElementById('editBtn');
  const saveBtn = document.getElementById('saveBtn');
  const inputs = document.querySelectorAll('#profileSection input');

  const setLoadingState = () => {
    userName.textContent = "Loading...";
    userEmail.value = "";
    userSchool.value = "";
    userAge.value = "";
  };

  const loadProfile = async (uid) => {
    setLoadingState();
    try {
      const userDoc = await getDoc(doc(db, "users", uid));
      if (userDoc.exists()) {
        const data = userDoc.data();
        userName.textContent = data.fullName || 'Not set';
        userEmail.value = data.email || 'Not set';
        userSchool.value = data.school || 'Not set';
        userAge.value = data.age || 'Not set';
      } else {
        userName.textContent = "User not found";
      }
    } catch (error) {
      userName.textContent = "Error loading profile";
      alert(`Error loading profile: ${error.message}`);
    }
  };

  onAuthStateChanged(auth, (user) => {
    if (user) {
      loadProfile(user.uid);
    } else {
      window.location.href = 'login.html';
    }
  });

  editBtn.addEventListener('click', () => {
    inputs.forEach(input => input.disabled = false);
    editBtn.style.display = 'none';
    saveBtn.style.display = 'inline-block';
  });

  saveBtn.addEventListener('click', async () => {
    try {
      const user = auth.currentUser;
      if (!user) return;
      await updateDoc(doc(db, "users", user.uid), {
        fullName: userName.textContent,
        school: userSchool.value,
        age: Number(userAge.value)
      });
      inputs.forEach(input => input.disabled = true);
      saveBtn.style.display = 'none';
      editBtn.style.display = 'inline-block';
      alert('Profile updated successfully!');
    } catch (error) {
      alert(`Error saving profile: ${error.message}`);
    }
  });

  function logout() {
  sessionStorage.clear(); // or sessionStorage.removeItem('loggedIn');
  window.location.href = 'login.html';
}


  document.getElementById('logoutBtn').addEventListener('click', async () => {
    try {
      await signOut(auth);
      window.location.href = 'login.html';
    } catch (error) {
      alert(`Logout failed: ${error.message}`);
    }
  });
</script>
<script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
 <div class="df-messenger-container-custom">
      <df-messenger
        chat-icon="https://github.com/LESTTERR/Time2study/blob/main/logo.png?raw=true"
        intent="WELCOME"
        chat-title="T2SBOT"
        agent-id="4558beea-12ba-46e0-9f37-0a0c394f92ec"
        language-code="en"
      ></df-messenger>
      <style>
  .df-messenger-container-custom {
    position: fixed;
    left: 50%;
    transform: translateX(-50%);
    bottom: 90px; /* Adjust to sit just above the tab bar */
    z-index: 1000;
  }
  @media (max-width: 600px) {
    .df-messenger-container-custom {
      width: 90vw;
      min-width: unset;
    }
  }
</style>

 </div>
</body>
</html>
